/*
 Copyright 2012-2015, Yahoo Inc.
 Copyrights licensed under the New BSD License. See the accompanying LICENSE file for terms.
 */
<<<<<<< HEAD
"use strict";
=======
'use strict';
>>>>>>> master

function TeamcityReport(opts) {
    opts = opts || {};
    this.file = opts.file || null;
    this.blockName = opts.blockName || 'Code Coverage Summary';
}

function lineForKey(value, teamcityVar) {
<<<<<<< HEAD
    return '##teamcity[buildStatisticValue key=\'' + teamcityVar + '\' value=\'' + value + '\']';
}

TeamcityReport.prototype.onStart = function (node, context) {
    var metrics = node.getCoverageSummary(),
        cw;

    cw = context.writer.writeFile(this.file);
    cw.println('');
    cw.println('##teamcity[blockOpened name=\''+ this.blockName +'\']');

    //Statements Covered
    cw.println(lineForKey(metrics.statements.covered, 'CodeCoverageAbsBCovered'));
=======
    return (
        "##teamcity[buildStatisticValue key='" +
        teamcityVar +
        "' value='" +
        value +
        "']"
    );
}

TeamcityReport.prototype.onStart = function(node, context) {
    const metrics = node.getCoverageSummary();
    const cw = context.writer.writeFile(this.file);

    cw.println('');
    cw.println("##teamcity[blockOpened name='" + this.blockName + "']");

    //Statements Covered
    cw.println(
        lineForKey(metrics.statements.covered, 'CodeCoverageAbsBCovered')
    );
>>>>>>> master
    cw.println(lineForKey(metrics.statements.total, 'CodeCoverageAbsBTotal'));

    //Branches Covered
    cw.println(lineForKey(metrics.branches.covered, 'CodeCoverageAbsRCovered'));
    cw.println(lineForKey(metrics.branches.total, 'CodeCoverageAbsRTotal'));

    //Functions Covered
<<<<<<< HEAD
    cw.println(lineForKey(metrics.functions.covered, 'CodeCoverageAbsMCovered'));
=======
    cw.println(
        lineForKey(metrics.functions.covered, 'CodeCoverageAbsMCovered')
    );
>>>>>>> master
    cw.println(lineForKey(metrics.functions.total, 'CodeCoverageAbsMTotal'));

    //Lines Covered
    cw.println(lineForKey(metrics.lines.covered, 'CodeCoverageAbsLCovered'));
    cw.println(lineForKey(metrics.lines.total, 'CodeCoverageAbsLTotal'));

<<<<<<< HEAD
    cw.println('##teamcity[blockClosed name=\''+ this.blockName +'\']');
=======
    cw.println("##teamcity[blockClosed name='" + this.blockName + "']");
>>>>>>> master
    cw.close();
};

module.exports = TeamcityReport;
