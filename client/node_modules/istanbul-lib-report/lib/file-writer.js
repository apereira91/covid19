/*
 Copyright 2012-2015, Yahoo Inc.
 Copyrights licensed under the New BSD License. See the accompanying LICENSE file for terms.
 */
<<<<<<< HEAD
var util = require('util'),
    path = require('path'),
    fs = require('fs'),
    mkdirp = require('mkdirp'),
    supportsColor = require('supports-color'),
    isAbsolute = path.isAbsolute || /* istanbul ignore next */ function (p) {
            return path.resolve(p) === path.normalize(p);
        };
=======
const util = require('util');
const path = require('path');
const fs = require('fs');
const mkdirp = require('make-dir');
const supportsColor = require('supports-color');
const isAbsolute =
    path.isAbsolute ||
    /* istanbul ignore next */ function(p) {
        return path.resolve(p) === path.normalize(p);
    };
>>>>>>> master

/**
 * abstract interface for writing content
 * @class ContentWriter
 * @constructor
 */
/* istanbul ignore next: abstract class */
<<<<<<< HEAD
function ContentWriter() {
}
=======
function ContentWriter() {}
>>>>>>> master

/**
 * writes a string as-is to the destination
 * @param {String} str the string to write
 */
/* istanbul ignore next: abstract class */
<<<<<<< HEAD
ContentWriter.prototype.write = function () {
=======
ContentWriter.prototype.write = function() {
>>>>>>> master
    throw new Error('write: must be overridden');
};

/**
 * returns the colorized version of a string. Typically,
 * content writers that write to files will return the
 * same string and ones writing to a tty will wrap it in
 * appropriate escape sequences.
 * @param {String} str the string to colorize
 * @param {String} clazz one of `high`, `medium` or `low`
 * @returns {String} the colorized form of the string
 */
<<<<<<< HEAD
ContentWriter.prototype.colorize = function (str /*, clazz*/) {
=======
ContentWriter.prototype.colorize = function(str /*, clazz*/) {
>>>>>>> master
    return str;
};

/**
 * writes a string appended with a newline to the destination
 * @param {String} str the string to write
 */
<<<<<<< HEAD
ContentWriter.prototype.println = function (str) {
=======
ContentWriter.prototype.println = function(str) {
>>>>>>> master
    this.write(str + '\n');
};

/**
 * closes this content writer. Should be called after all writes are complete.
 */
<<<<<<< HEAD
ContentWriter.prototype.close = function () {
};
=======
ContentWriter.prototype.close = function() {};
>>>>>>> master

/**
 * a content writer that writes to a file
 * @param {Number} fd - the file descriptor
 * @extends ContentWriter
 * @constructor
 */
function FileContentWriter(fd) {
    this.fd = fd;
}
util.inherits(FileContentWriter, ContentWriter);

<<<<<<< HEAD
FileContentWriter.prototype.write = function (str) {
    fs.writeSync(this.fd, str);
};

FileContentWriter.prototype.close = function () {
=======
FileContentWriter.prototype.write = function(str) {
    fs.writeSync(this.fd, str);
};

FileContentWriter.prototype.close = function() {
>>>>>>> master
    fs.closeSync(this.fd);
};

/**
 * a content writer that writes to the console
 * @extends ContentWriter
 * @constructor
 */
<<<<<<< HEAD
function ConsoleWriter() {
}
util.inherits(ConsoleWriter, ContentWriter);

// allow stdout to be captured for tests.
var capture = false;
var output = '';
ConsoleWriter.prototype.write = function (str) {
=======
function ConsoleWriter() {}
util.inherits(ConsoleWriter, ContentWriter);

// allow stdout to be captured for tests.
let capture = false;
let output = '';
ConsoleWriter.prototype.write = function(str) {
>>>>>>> master
    if (capture) {
        output += str;
    } else {
        process.stdout.write(str);
    }
};

<<<<<<< HEAD
ConsoleWriter.prototype.colorize = function (str, clazz) {
    var colors = {
=======
ConsoleWriter.prototype.colorize = function(str, clazz) {
    const colors = {
>>>>>>> master
        low: '31;1',
        medium: '33;1',
        high: '32;1'
    };

    /* istanbul ignore next: different modes for CI and local */
<<<<<<< HEAD
    if (supportsColor && colors[clazz]) {
=======
    if (supportsColor.stdout && colors[clazz]) {
>>>>>>> master
        return '\u001b[' + colors[clazz] + 'm' + str + '\u001b[0m';
    }
    return str;
};

/**
 * utility for writing files under a specific directory
 * @class FileWriter
 * @param {String} baseDir the base directory under which files should be written
 * @constructor
 */
function FileWriter(baseDir) {
    if (!baseDir) {
        throw new Error('baseDir must be specified');
    }
    this.baseDir = baseDir;
}

/**
<<<<<<< HEAD
* static helpers for capturing stdout report output;
* super useful for tests!
*/
FileWriter.startCapture = function () {
  capture = true;
};
FileWriter.stopCapture = function () {
  capture = false;
};
FileWriter.getOutput = function () {
  return output;
};
FileWriter.resetOutput = function () {
  output = '';
=======
 * static helpers for capturing stdout report output;
 * super useful for tests!
 */
FileWriter.startCapture = function() {
    capture = true;
};
FileWriter.stopCapture = function() {
    capture = false;
};
FileWriter.getOutput = function() {
    return output;
};
FileWriter.resetOutput = function() {
    output = '';
>>>>>>> master
};

/**
 * returns a FileWriter that is rooted at the supplied subdirectory
 * @param {String} subdir the subdirectory under which to root the
 *  returned FileWriter
 * @returns {FileWriter}
 */
<<<<<<< HEAD
FileWriter.prototype.writerForDir = function (subdir) {
    if (isAbsolute(subdir)) {
        throw new Error('Cannot create subdir writer for absolute path: ' + subdir);
=======
FileWriter.prototype.writerForDir = function(subdir) {
    if (isAbsolute(subdir)) {
        throw new Error(
            'Cannot create subdir writer for absolute path: ' + subdir
        );
>>>>>>> master
    }
    return new FileWriter(this.baseDir + '/' + subdir);
};
/**
 * copies a file from a source directory to a destination name
 * @param {String} source path to source file
 * @param {String} dest relative path to destination file
<<<<<<< HEAD
 */
FileWriter.prototype.copyFile = function (source, dest) {
=======
 * @param {String} [header=undefined] optional text to prepend to destination
 *  (e.g., an "this file is autogenerated" comment, copyright notice, etc.)
 */
FileWriter.prototype.copyFile = function(source, dest, header) {
>>>>>>> master
    if (isAbsolute(dest)) {
        throw new Error('Cannot write to absolute path: ' + dest);
    }
    dest = path.resolve(this.baseDir, dest);
    mkdirp.sync(path.dirname(dest));
<<<<<<< HEAD
    fs.writeFileSync(dest, fs.readFileSync(source));
=======
    let contents;
    if (header) {
        contents = header + fs.readFileSync(source, 'utf8');
    } else {
        contents = fs.readFileSync(source);
    }
    fs.writeFileSync(dest, contents);
>>>>>>> master
};
/**
 * returns a content writer for writing content to the supplied file.
 * @param {String|null} file the relative path to the file or the special
 *  values `"-"` or `null` for writing to the console
 * @returns {ContentWriter}
 */
<<<<<<< HEAD
FileWriter.prototype.writeFile = function (file) {
=======
FileWriter.prototype.writeFile = function(file) {
>>>>>>> master
    if (file === null || file === '-') {
        return new ConsoleWriter();
    }
    if (isAbsolute(file)) {
        throw new Error('Cannot write to absolute path: ' + file);
    }
    file = path.resolve(this.baseDir, file);
    mkdirp.sync(path.dirname(file));
    return new FileContentWriter(fs.openSync(file, 'w'));
};

module.exports = FileWriter;
